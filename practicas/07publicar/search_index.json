[["index.html", "Publicar Información Geográfica en la Web mediante GeoServer Sistemas de Información Geográfica 1 Introducción", " Publicar Información Geográfica en la Web mediante GeoServer Sistemas de Información Geográfica José Samos Jiménez (jsamos@ugr.es) Dpto. de Lenguajes y Sistemas Informáticos Universidad de Granada Curso 2024-2025 Citar y Licencia: https://doi.org/10.6084/m9.figshare.26967223.v4 1 Introducción Disponemos de la información geográfica de nuestro municipio almacenada como archivos y en PostGIS. En esta actividad, vamos a ofrecer esa información mediante servidor Web de datos espaciales: GeoServer. Objetivos El objetivo principal es repasar los conceptos sobre publicación de Información Geográfica en la Web materializados en un servidor concreto, GeoServer. Configurar en GeoServer distintas fuentes de datos: vectorial y ráster. Acceder a GeoServer desde QGIS. Acceder a GeoServer desde una aplicación Web. Las actividades planteadas se basan en Iacovella and Youngblood (2013) y Iacovella (2014). Referencias Iacovella, Stefano. 2014. GeoServer Cookbook. Packt Publishing. Iacovella, Stefano, and Brian Youngblood. 2013. GeoServer Beginner’s Guide. Packt Publishing. "],["iniciar-y-parar-geoserver.html", "2 Iniciar y parar GeoServer 2.1 Iniciar GeoServer 2.2 Acceder a la página de administración de GeoServer 2.3 Parar GeoServer", " 2 Iniciar y parar GeoServer GeoServer es un servidor Web de datos espaciales: permite publicar datos espaciales mediante los estándares de OGC. Es una aplicación de código abierto desarrollada en Java. En relación con la instalación de la herramienta, en el momento de instalar GeoServer, se configura con la ubicación de la carpeta donde está Java. Un problema que he encontrado es que si se actualiza Java y pasa a estar en otra carpeta (cambia el nombre con el número de versión), GeoServer deja de funcionar. La manera más sencilla de arreglarlo es volver a ejecutar el instalador e indicar la nueva carpeta de Java. 2.1 Iniciar GeoServer Figura 2.1: Iniciar GeoServer. En la instalación, se puede configurar para que se inicie el servidor automáticamente al arrancar el sistema. En lugar de esa opción, he elegido la alternativa de iniciar el servidor manualmente. Se inicia pulsando sobre el icono GeoServer Start del escritorio1 (figura 2.1). Figura 2.2: Ventana de comandos para el inicio de GeoServer. Para iniciarse, se abre una ventana del Sistema y comienzan a ejecutarse comandos. Tarda un poco en ponerse en marcha. Acaba cuando aparece el mensaje INFO:oejs.Server:main: Started, como puede verse en la última línea de la figura 2.2. 2.2 Acceder a la página de administración de GeoServer Figura 2.3: Acceder a la página de administración de GeoServer. Una vez está en marcha el servidor, podemos abrir la aplicación de administración en el navegador. Se puede hacer directamente pulsando sobre el icono GeoServer Web Admin Page del escritorio2 (figura 2.3). Figura 2.4: Página de inicio de GeoServer. La página de inicio de la aplicación de administración de GeoServer se muestra en la figura 2.4. En esta página, nos muestra una pantalla de bienvenida y, en la columna de la derecha, lista las Capacidades del servicio: las versiones de los distintos estándares bajo los que puede servir datos. Mediante las opciones de la zona izquierda, podemos obtener información más detallada del servidor, consultar las capas disponibles y demostraciones de posibles operaciones con GeoServer. Una vez nos hemos identificado, podemos acceder a las opciones de administración. 2.3 Parar GeoServer Figura 2.5: Parar el servidor GeoServer. En esta actividad vamos a trabajar con GeoServer, necesitamos que esté funcionando. Cuando la acabemos o, en caso de que quisiéramos pararlo, deberíamos pulsar sobre el icono GeoServer Stop del escritorio3 (figura 2.5). Como resultado se ejecuta el archivo por lotes startup de la carpeta bin de la instalación de Geoserver.↩︎ Como resultado abre en el navegador la URL http://http://localhost:8080/geoserver/web.↩︎ Como resultado se ejecuta el archivo por lotes shutdown de la carpeta bin de la instalación de Geoserver.↩︎ "],["información-de-contacto-y-estado-del-servidor.html", "3 Información de contacto y estado del servidor 3.1 Cambiar la información de contacto 3.2 Estado del servidor", " 3 Información de contacto y estado del servidor 3.1 Cambiar la información de contacto Figura 3.1: Página de bienvenida de GeoServer. En la página de bienvenida (figura 3.1), nos indica a quién pertenece esta instancia de GeoServer, también la cantidad de información que contiene, organizada en capas, almacenes y espacios de trabajo. Figura 3.2: Información de contacto. Podemos cambiar la información de contacto pulsando sobre Servidor &gt; Información de contacto (figura 3.2) e introduciendo nuestros datos. Al pulsar sobre el botón Enviar, podemos comprobar que la pantalla de bienvenida presenta los datos de nuestra organización que hayamos introducido. 3.2 Estado del servidor Figura 3.3: Estado del servidor. Pulsando sobre Servidor &gt; Estado del servidor (figura 3.3), accedemos a la pantalla que nos muestra el estado del servidor. Esta pantalla puede resultar de interés en caso de presentarse problemas de funcionamiento. En particular, en caso de producirse algún bloqueo, basta con pulsar sobre el botón Liberar bloqueos. "],["añadir-información-geográfica.html", "4 Añadir información geográfica 4.1 Espacios de trabajo 4.2 Almacenes de datos 4.3 Capas 4.4 Previsualización de capas", " 4 Añadir información geográfica Para añadir información geográfica a Geoserver se usan tres conceptos: espacios de trabajo, almacenes de datos, capas. El espacio de trabajo se puede entender como el espacio de nombres: el nombre que va a permitir agrupar toda la información geográfica que deseemos. Se añadirá como prefijo a los nombres de las capas que se utilicen. Asociado a un espacio de trabajo, se pueden definir uno o varios almacenes de datos: el medio donde se almacena la información geográfica. Puede ser una carpeta, un archivo o una BD, entre otros. Por último, podemos configurar las capas de información geográfica incluidas en cada almacén de datos. Para acceder a una capa concreta, deberemos indicar también el espacio de trabajo que tiene asociado (el almacén de datos resulta transparente). 4.1 Espacios de trabajo Figura 4.1: Espacios de trabajo. Para acceder a los espacios de trabajo, pulsamos sobre Datos &gt; Espacios de trabajo (figura 4.1). Podemos ver una lista de los espacios de trabajo existentes en nuestra instancia de GeoServer. Además de poder eliminar cualquier espacio de trabajo, desde esta pantalla podemos crear nuevos espacios. Figura 4.2: Nuevo espacio de trabajo. Para crear un nuevo espacio de trabajo, pulsamos sobre el enlace Agregar un nuevo espacio de trabajo (figura 4.2) e introducimos los datos: el nombre y una URI. Ambos datos son obligatorios. La URI4 la usa para definir el espacio de nombres5 asociado al espacio de trabajo. Podemos indicar que el nuevo espacio de trabajo sea el espacio de trabajo por defecto, marcando la opción correspondiente. 4.2 Almacenes de datos Figura 4.3: Almacenes de datos. Para acceder a los almacenes de datos, pulsamos sobre Datos &gt; Almacenes de datos (figura 4.3). Podemos ver una lista de los almacenes de datos asociados a espacios de trabajo. Se puede observar que algunos espacios de trabajo están relacionados con varios almacenes de datos. Figura 4.4: Nuevo almacén de datos. Para crear un nuevo almacén de datos, pulsamos sobre el enlace Agregar un nuevo almacén (figura 4.3) y, según los datos sean vectoriales o ráster, seleccionamos el tipo de almacén (figura 4.4). También se pueden configurar servidores en cascada si se selecciona como origen de datos otro servidor. En este ejemplo, se ha usado PostGIS como almacén de datos vectoriales y archivos GeoTIFF como almacén de datos ráster6. 4.2.1 PostGIS como almacén de datos Figura 4.5: PostGIS como almacén de datos. La página de configuración de PostGIS como almacén de datos se muestra en la figura 4.5. Se ha de indicar el espacio de trabajo (en este caso he indicado SIG) y darle un nombre al origen de datos. Además, se indican los parámetros de conexión a la BD. Figura 4.6: Lista de capas disponibles en el almacén de datos. Una vez realizada la conexión, aparece una lista con las capas disponibles en el almacén de datos (figura 4.6). A esta lista también podemos acceder desde la opción Datos &gt; Capas (la veremos en el apartado 4.3). 4.2.2 Archivo GeoTIFF como almacén de datos Figura 4.7: Archivo GeoTIFF como almacén de datos. Figura 4.8: Definición de un archivo GeoTIFF como almacén de datos. En la figura 4.7, se muestra la selección de un archivo GeoTIFF como almacén de datos. En la figura 4.8, se definen los parámetros del nuevo almacén de datos. En este caso, los parámetros de conexión son solo la URL del archivo. Figura 4.9: Capa disponible en el almacén de datos. En este caso, la única capa disponible en el almacén de datos se muestra en la figura 4.9. En el caso de que queramos publicar conjuntamente todas las bandas del archivo (MDT, ortofotografía, banda individual de satélite), podemos publicarlas directamente pulsando sobre el enlace Publicación (figura 4.9). En caso contrario (el archivo tiene varias bandas para publicar de forma individual o en subconjuntos), deberemos acceder a la publicación de las capas para publicar las bandas que nos interese seleccionar. 4.3 Capas Una vez definido un almacén de datos, podemos gestionar la publicación de sus capas. Al añadir un nuevo almacén de datos, automáticamente se muestran las capas que contiene, como se presenta en las figuras 4.6 y 4.9. Figura 4.10: Lista de capas publicadas. Figura 4.11: Agregar una nueva capa. También podemos acceder a la lista de capas de cualquier almacén pulsando sobre la opción Datos &gt; Capas (figura 4.10) y pulsando, a continuación, sobre el enlace Agregar nueva capa. En la nueva pantalla a la que accedemos, seleccionamos el almacén de datos que contiene la nueva capa (figura 4.11) 4.3.1 PostGIS como almacén de datos Si tenemos PostGIS como almacén de datos, nos aparece la lista de capas del almacén seleccionado: en este caso la lista de la figura 4.6. Figura 4.12: Publicar una nueva capa. Pulsando sobre el enlace Publicación, situado a la derecha del nombre de la capa que queremos publicar (figura 4.6), se abre la ventana donde podemos configurar los parámetros de publicación de la capa (figura 4.12). Figura 4.13: Definir Encuadres. Para las capas vectoriales, tenemos que definir necesariamente el apartado Encuadres (figura 4.13). Se puede definir fácilmente pulsando sobre los enlaces Calcular desde los datos y Calcular desde el encuadre nativo. 4.3.1.1 Publicación mediante la API REST de GeoServer Podemos publicar las capas vectoriales almacenadas en PostGIS mediante la API REST de GeoServer. A continuación se muestra el código ejemplo para una de las capas, una vez definida la base de datos como almacén de datos. # acceso a GeoServer geoserver_url &lt;- &quot;http://localhost:8080/geoserver&quot; user &lt;- &quot;admin&quot; password &lt;- &quot;geoserver&quot; # espacio de nombres y almacén de datos workspace &lt;- &quot;lanjaron_jsamos&quot; data_store &lt;- &quot;lanjaron_jsamos&quot; # nombre de capa a publicar layer_name &lt;- &quot;cc_manz_lanjaron_jsamos&quot; layer_config &lt;- list( featureType = list( name = layer_name, nativeName = layer_name, title = layer_name ) ) layer_config_json &lt;- jsonlite::toJSON(layer_config, auto_unbox = TRUE) url &lt;- paste0(geoserver_url, &quot;/rest/workspaces/&quot;, workspace, &quot;/datastores/&quot;, data_store, &quot;/featuretypes&quot;) response &lt;- httr::POST( url, httr::authenticate(user, password), httr::add_headers(&quot;Content-Type&quot; = &quot;application/json&quot;), body = layer_config_json, encode = &quot;json&quot; ) if (httr::status_code(response) == 201) { cat(&quot;Capa publicada.&quot;) } else { cat(&quot;Error:&quot;, httr::content(response, &quot;text&quot;)) } Podemos definir una función y llamarla con el nombre de cada capa. 4.3.2 Archivo GeoTIFF como almacén de datos Figura 4.14: Configurar una nueva vista de Cobertura. Si tenemos un archivo GeoTIFF como almacén de datos y queremos publicar todas las bandas conjuntamente, pulsamos sobre el enlace Publicación o, si ya lo habíamos publicado antes y queremos volver a publicarlo cambiando la configuración, el enlace será Publicar de nuevo (figura 4.14). Pero si queremos publicar una selección de las bandas contenidas en el archivo GeoTIFF, deberemos pulsar cobre el enlace Configurar una nueva vista de Cobertura que aparece en el texto explicativo (figura 4.14). Figura 4.15: Crear nueva vista de cobertura. En la ventana “Crear nueva vista de cobertura” (figura 4.15), seleccionamos las bandas de salida y le podemos asignar el nombre que corresponda según la selección realizada. Los nombres de las bandas no aparecen, solo está disponible el índice de cada banda en la estructura del archivo GeoTIFF. Deberemos consultarlos usando QGIS o R, para asignarlos correctamente. 4.4 Previsualización de capas Figura 4.16: Previsualización de capas. Pulsando sobre Datos &gt; Previsualización de capas accedemos a la pantalla que nos permite ver o descargar las capas en cualquiera de los formatos disponibles (figura 4.16). Por ejemplo, para ver una capa mediante OpenLayers, pulsando sobre el enlace OpenLayers situado a la derecha del nombre de la capa, en la figura 4.16, se muestra en una nueva pestaña del navegador la capa. Puede ser una URL, aunque no es necesario que lo sea.↩︎ De acuerdo con el concepto de XML.↩︎ Aunque estén las capas ráster en PostGIS, no lo soporta como almacén de datos ráster.↩︎ "],["consultar-información-geográfica-desde-otras-herramientas.html", "5 Consultar información geográfica desde otras herramientas 5.1 Consulta desde QGIS 5.2 Consulta desde una aplicación Web", " 5 Consultar información geográfica desde otras herramientas Una vez hemos añadido las capas que deseemos al espacio de trabajo, podemos consultarlas por distintos medios. En esta sección, vamos a consultarlas desde QGIS y también desde una aplicación Web con JavaScript. 5.1 Consulta desde QGIS Desde QGIS podemos acceder al servidor GeoServer mediante los estándares que soporta. Figura 5.1: Conexión WMS. En la figura 5.1, se muestra el procedimiento para establecer la conexión mediante un estándar, por ejemplo WMS: en la ventana del Navegador, en el menú contextual elegimos la opción Conexión nueva… Figura 5.2: Crear una nueva conexión WMS. En la figura 5.2, se muestra la ventana de configuración de la conexión. Indicamos el nombre que deseemos darle, la URL del servidor (en el ejemplo, http://localhost:8080/geoserver/SIG/wms?) compuesta por el nombre del espacio de trabajo que he usado (SIG) y el nombre del estándar mediante el que nos conectamos (en el ejemplo de la figura wms). Figura 5.3: Lista de capas disponibles para el espacio de trabajo seleccionado. El resultado de la conexión es una lista de las capas disponibles bajo ese estándar para el espacio de trabajo (figura 5.3). Figura 5.4: Capas de GeoServer mostradas en QGIS. Estas capas pueden añadirse al lienzo de QGIS desde sus respectivos menús contextuales. El resultado del ejemplo se muestra en la figura 5.4. Figura 5.5: Lista de capas disponibles según los distintos estándar. En la figura 5.5, se muestran las capas de las conexiones establecidas con GeoServer según los distintos estándar para el espacio de trabajo del ejemplo considerado. 5.2 Consulta desde una aplicación Web Vamos a utilizar el complemento qgis2web de QGIS para generar una aplicación Web a partir de las capas presentadas en el lienzo de QGIS. Funciona a partir de cualquier combinación de capas presentadas en QGIS (por supuesto, a partir de capas locales), pero lo vamos a usar con las capas obtenidas de la conexión establecida con GeoServer. Este complemento no está instalado en la instalación inicial de QGIS, tendremos que instalarlo. Una vez instalado, podemos acceder a él directamente desde la barra de herramientas o también pulsando sobre Web &gt; qgis2web &gt; Create web map. Figura 5.6: Definición de parámetros del complemento qgis2web. Figura 5.7: Selección de capas del complemento qgis2web. En primer lugar, en la parte inferior de la ventana que se abre, seleccionamos la librería JavaScript que queremos usar y, en la pestaña Export, indicamos la carpeta en la que se generará el código (figura 5.6). En la pestaña Layers and Groups (figura 5.7) seleccionamos las capas a exportar. Cuando pulsamos sobre el botón Export lleva a cabo el proceso de generación del código para presentar las capas seleccionadas de acuerdo a la configuración elegida. Figura 5.8: Presentación del resultado del complemento qgis2web. El resultado obtenido depende del estándar que usemos para acceder a GeoServer. En la figura 5.8, se muestra el resultado para el ejemplo considerado. Figura 5.9: Código generado por el complemento qgis2web. En la figura 5.9, se muestra el código generado por el complemento para este ejemplo, el correspondiente al archivo index.html. Podemos acceder a él en la carpeta donde hemos indicado que se lleve a cabo la generación. Figura 5.10: Presentación del nuevo resultado del complemento qgis2web. El resultado de la figura 5.8 no coincide exactamente con lo que se mostraba en QGIS, en este caso se muestran los distintos azulejos componentes del ráster. Si observamos el código de la figura 5.9, a partir de la línea 41 se hace la llamada a GeoServer para obtener el ráster: incluye un parámetro tiled: true en la línea 44. Si editamos el archivo y cambiamos ese parámetro para que sea tiled: false, el resultado que obtenemos es el que se presenta en la figura 5.10. "],["ejercicios.html", "Ejercicios Datos de trabajo Ejercicios", " Ejercicios Datos de trabajo Para el municipio seleccionado, los datos de partida los hemos obtenido en actividades anteriores. Aquí se detallan por tipo. Utilizaremos los datos almacenados en PostGIS para las capas vectoriales y los datos almacenados en archivos en formato GeoTIFF para los datos ráster. Zona de trabajo: término municipal nombre: compuesto por el nombre del municipio (8 letras, sin espacios), -, y usuario de correo (p.e, lanjaron-jsamos) mínimo rectángulo que contiene al término municipal nombre: nombre anterior pero con -bbox- en lugar de - (p.e, lanjaron-bbox-jsamos) Para cada capa de los apartados siguientes, se indica el primer componente del nombre, el resto del nombre depende de los nombres de las capas de la zona de trabajo. Capas vectoriales capas temáticas: capa de líneas sobre vías de comunicación nombre: tem-viac- capas temáticas: capa de líneas sobre red hidrográfica nombre: tem-redh- capas temáticas: capa de puntos sobre cualquier tema nombre: tem-punt- capas temáticas: capa de polígonos sobre cualquier tema nombre: tem-poli- CartoCiudad con las capas con datos de manzana y portal nombres: cc-manz- y cc-port-, respectivamente CORINE Land Cover nombre: clc- Capas ráster archivos de ortofotografía nombre: ort- archivos de MDT nombre: mdt- bandas de satélite nombre: sat- si se ha generado cada banda en un archivo, tiene el nombre de la banda en cada uno (p.e., sat-b1-, sat-b2-, etc.) si se han generado las bandas en archivos, clasificadas por su resolución, tiene el identificador de la resolución en cada uno (p.e., sat-r10m-, sat-r20m-, etc.) Las bandas de satélite necesitan estar almacenadas en archivos separados para poder ser tratadas de forma individual, el nombre de las capas estará compuesto por el nombre de la banda, con el prefijo compuesto por sat_, y el sufijo con la resolución (p.e., _r30m) y la parte correspondiente al nombre de la capa de recorte que su usó. Por ejemplo, en mi caso, los nombres para los archivos la banda 1, para Landasat 8 son sat_B1_r30m_lanjaron_bbox_jsamos y sat_B1_r30m_lanjaron_jsamos. En caso de disponer de las bandas en varias resoluciones espaciales, cada banda se ha de incluir una sola vez, con la resolución más fina disponible. Ejercicios Ejercicio 1. Añadir capas (80%) Crea un espacio de trabajo cuyo nombre sea el nombre del municipio y tu usuario de correo de la UGR (p.e., en mi caso lanjaron-jsamos). Añade al espacio de trabajo, conservando el nombre de cada capa, las capas que se indican en apartado anterior (Datos de trabajo): para las capas vectoriales, añade solo las capas recortadas por el polígono del municipio (vectoriales: solo las capas que no son bbox), incluyendo la capa de la zona de trabajo (el polígono del municipio), para las capas ráster, añade solo las recortadas por el rectángulo envolvente (ráster: solo las capas bbox). Para el resto de nombres que no se indican en este enunciado, usa los que consideres más adecuados. Para documentar la realización del ejercicio, siguiendo la estructura del apartado Datos de trabajo, para cada capa añadida: incluye una captura de pantalla completa de la ventana que abre al realizar de la Previsualización de capas usando OpenLayers de la capa correspondiente. Ejercicio 2. Consultas desde QGIS (10%) Consulta y muestra en QGIS la capa ráster mdt- y la del polígono del término municipal de tu espacio de trabajo en Geoserver. Para documentar la realización del ejercicio, incluye dos capturas de pantalla completa donde se muestre: las capas disponibles de la conexión con Geoserver y las dos capas indicadas en el área de visualización de QGIS. Ejercicio 3. Consultas Web (10%) Muestra mediante una aplicación Web (se puede desarrollar mediante QGIS o R) la capa ráster mdt- y la del polígono del término municipal de tu espacio de trabajo en Geoserver. Para documentar la realización del ejercicio, incluye dos capturas de pantalla completa donde se muestre: la definición (mediante QGIS o R), las capas en la aplicación Web. "],["referencias.html", "Referencias", " Referencias Iacovella, Stefano. 2014. GeoServer Cookbook. Packt Publishing. Iacovella, Stefano, and Brian Youngblood. 2013. GeoServer Beginner’s Guide. Packt Publishing. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
