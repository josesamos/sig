[["index.html", "Analizar Información Geográfica Sistemas de Información Geográfica 1 Introducción", " Analizar Información Geográfica Sistemas de Información Geográfica José Samos Jiménez (jsamos@ugr.es) Dpto. de Lenguajes y Sistemas Informáticos Universidad de Granada Curso 2024-2025 Citar y Licencia: https://doi.org/10.6084/m9.figshare.26969200.v1 1 Introducción Disponemos de la información geográfica de nuestro municipio almacenada como archivos y en BD GeoPackage y PostGIS. En este tema, vamos a aplicar varias técnicas de análisis a esta información desde QGIS o desde R. Objetivos Presentar diversas técnicas para realizar análisis vectorial desde QGIS y R, en concreto: Realizar consultas espaciales básicas mediante SQL sobre PostGIS desde QGIS. Realizar consultas espaciales básicas mediante SQL sobre PostGIS desde R. Presentar distintas técnicas de análisis de datos ráster. Generar datos vectoriales a partir de datos ráster, en particular para el MDT. Generar el MDT a partir de datos vectoriales. Utilizar los datos ráster generados para presentar los datos. A continuación, se irán presentando los pasos a realizar y cómo llevarlos a cabo con las distintas opciones consideradas. "],["analizar-consulta-qgis.html", "2 Consultas espaciales sobre BD desde QGIS 2.1 Consulta sobre una capa 2.2 Consulta sobre dos capas", " 2 Consultas espaciales sobre BD desde QGIS QGIS ofrece varias posibilidades para analizar información geográfica. En este caso, el análisis se realiza en la BD (PostGIS), mediante la consulta que ejecuta: QGIS actúa como medio de acceso a la BD y de representación gráfica del resultado. Las operaciones a realizar sobre BD están basadas en Marquez (2015). Para formular una consulta en SQL desde QGIS sobre una BD espacial, en primer lugar, debemos acceder al administrador de BD de QGIS (pulsando sobre Base de datos &gt; Administrador de bases de datos…) y seleccionar una BD para conectarnos a ella. Previamente hemos de haber definido la conexión, como se ha hecho en el tema de almacenamiento de información geográfica. Una vez con acceso a la BD, debemos abrir la pestaña para formular consultas: pulsando sobre la opción Base de datos &gt; Ventana SQL. El resultado es que se abre una pestaña de formulación de consultas asociada a la BD seleccionada en el momento de abrir la ventana. Se pueden tener varias pestañas de consulta abiertas al mismo tiempo, una por cada BD distinta. 2.1 Consulta sobre una capa La consulta que vamos a definir se muestra a continuación. SELECT ST_Union(ST_Buffer(geom, 100)) as zona_rio FROM red_hidro_lanjaron_jsamos; Obtenemos un buffer (ST_Buffer) a partir de las líneas de una capa. Además, en la misma consulta, los componentes del resultado se fusionan (ST_Union). La consulta se ha definido en PostGIS para la capa correspondiente a la red hidrográfica del municipio. Figura 2.1: Consulta y resultado sobre PostGIS desde QGIS. En la figura 2.1, se puede ver la formulación de la consulta en la ventana de consultas de PostGIS. Al pulsar sobre el botón Ejecutar, PostGIS ejecuta la consulta y devuelve el resultado en forma de tabla. Si seleccionamos la opción Cargar como capa nueva, podemos indicar la columna que identifica los registros (si hay alguna) y la columna del resultado que contiene los datos geométricos (en la figura, la columna zona_rio); si pulsamos sobre el botón Cargar, carga los resultados como una capa más de QGIS, sobre la que podemos operar normalmente. Figura 2.2: Resultado de la consulta de PostGIS como capa en QGIS. La capa resultado de la consulta cargada en QGIS se muestra en la figura 2.2. Partiendo de una capa vectorial compuesta por líneas, hemos obtenido una capa compuesta por polígonos mediante las operaciones de transformación que hemos utilizado. 2.2 Consulta sobre dos capas Vamos a realizar un consulta sobre datos geográficos en la que intervienen dos capas. A continuación, se muestra la definición de la consulta considerada para PostGIS. SELECT p.* FROM cc_portal_lanjaron_jsamos p WHERE EXISTS ( SELECT * FROM red_hidro_lanjaron_jsamos WHERE ST_DWithin(p.geom, geom, 100) ); Se trata de obtener los portales (de la capa de CartoCiudad) que se encuentren a menos de una distancia determinada de un elemento de la red hidrográfica. Definiremos la distancia de manera que se obtenga un resultado no vacío. Figura 2.3: Consulta sobre dos capas y resultado obtenido. En la figura 2.3, se puede ver la formulación de la consulta. En este caso, podemos indicar la columna que identifica los registros y la columna del resultado que contiene los datos geométricos. Figura 2.4: Resultados de las consultas como capas en QGIS. La capa resultado de la consulta (junto con la capa resultado de la consulta anterior) cargada en QGIS se muestra en la figura 2.4. Referencias Marquez, Angel. 2015. PostGIS Essentials. Packt Publishing. "],["consultas-espaciales-sobre-bd-desde-r.html", "3 Consultas espaciales sobre BD desde R 3.1 Consulta sobre una capa 3.2 Consulta sobre dos capas", " 3 Consultas espaciales sobre BD desde R En este apartado vamos a realizar desde R, sobre una BD de nuestro municipio, las mismas consultas desarrolladas en el apartado 2 desde QGIS. 3.1 Consulta sobre una capa Para realizar una consulta sobre una BD podemos utilizar la función st_read del paquete sf. En el parámetro con indicamos la cadena de conexión, en este caso, la indicada para acceder a la BD PostGIS. library(sf) con &lt;- RPostgres::dbConnect( RPostgres::Postgres(), dbname = &#39;lanjaron_jsamos&#39;, host = &#39;localhost&#39;, port = &#39;5432&#39;, user = &#39;postgres&#39;, password = &#39;postgres&#39; ) query = paste( &#39;SELECT ST_Union(ST_Buffer(geom, 100)) as zona_rio&#39;, &#39;FROM red_hidro_lanjaron_jsamos&#39;, sep = &quot; &quot; ) resultado &lt;- st_read(con, query = query) plot(st_geometry(resultado)) La consulta también se define como una cadena que se pasa como parámetro a la función st_read. El resultado es una capa que podemos tratar normalmente Figura 3.1: Consulta sobre una capa y resultado obtenido en RStudio. En la figura 3.1, se muestra la consulta y el resultado obtenido en RStudio. Podemos obtener el mismo resultado utilizando la BD exclusivamente para obtener la capa original y transformándola adecuadamente mediante funciones del paquete sf, como se muestra a continuación. redHidro &lt;- st_read(con, layer=&quot;red_hidro_lanjaron_jsamos&quot;) resultado &lt;- st_union(st_buffer(redHidro, dist = 100)) plot(st_geometry(resultado)) Con QGIS podríamos haber realizado una transformación similar a partir de la capa original, mediante las operaciones disponibles en los menús para datos vectoriales. 3.2 Consulta sobre dos capas query = paste( &#39;SELECT p.*&#39;, &#39; FROM cc_portal_lanjaron_jsamos p&#39;, &#39;WHERE EXISTS (&#39;, &#39; SELECT *&#39;, &#39; FROM red_hidro_lanjaron_jsamos&#39;, &#39; WHERE ST_DWithin(p.geom, geom, 100)&#39;, &#39;)&#39;, sep = &quot; &quot; ) resultado2 &lt;- st_read(con, query = query) plot(st_geometry(resultado2), col = &#39;red&#39;, add = TRUE) En el fragmento de código anterior, se muestran las operaciones para realizar la consulta en la que intervienen dos capas y la presentación del resultado junto a al resultado obtenido en el último apartado. Se usa la variable con la cadena de conexión definida anteriormente. Figura 3.2: Consulta sobre dos capas y resultado obtenido en RStudio. En la figura 3.2, se muestra la consulta sobre dos capas y el resultado obtenido en RStudio. "],["operaciones-sobre-bandas-de-satélite.html", "4 Operaciones sobre bandas de satélite 4.1 Color natural 4.2 Índice de vegetación 4.3 Combinar bandas en R", " 4 Operaciones sobre bandas de satélite Partiendo de las bandas de satélite para nuestro municipio, podemos realizar diversas composiciones de color. En este caso, vamos a obtener el llamado color natural. También vamos a obtener a partir de ellas un índice de vegetación de la zona. 4.1 Color natural Para obtener la composición color natural necesitamos las bandas 2, 3 y 4 de Landsat-8 o bien de Sentinel-2 (en ambos casos, esas bandas representan la misma información). 4.1.1 Obtención en QGIS En primer lugar, tenemos que crear un ráster virtual con esas bandas (Ráster &gt; Miscelánea &gt; Construir ráster virtual…). En la ventana de selección múltiple de las bandas de entrada, hemos de tener presente el orden de las bandas que seleccionamos ya que, posteriormente, se nombrarán como Banda 1, Banda 2 y Banda 3, en lugar de sus nombres originales. Tenemos que saber qué banda es cada una. Figura 4.1: Definir un ráster virtual multibanda. En la ventana de definición del ráster virtual (figura 4.1), es muy importante dejar seleccionada la opción Place each input file into a separate band. Esta opción es la diferencia entre un ráster virtual multibanda (como es el caso) y otro compuesto por otros ráster que se solapan. Figura 4.2: Definir un ráster virtual multibanda. Una vez creada la nueva capa, tenemos que indicar qué bandas se corresponden con las bandas roja, verde y azul. Esto se define en las propiedades de la nueva capa, en el apartado Simbología (figura 4.2). Partimos de las bandas 2, 3 y 4, al incorporarlas en el ráster virtual son, respectivamente, las bandas Banda 1, Banda 2 y Banda 3. Si miramos en cualquiera de las tablas de descripción de bandas de Landsat-8 o de Sentinel-2, la banda 4 (Banda 3 en el ráster virtual) es la banda roja, la banda 3 (Banda 2 en el ráster virtual) es la verde y la banda 2 (Banda 1 en el ráster virtual) es la azul. Esto es lo que se define en la figura 4.2. De igual forma, creando ráster virtuales con las bandas adecuadas, podemos generar las combinaciones que deseemos. 4.2 Índice de vegetación El Índice de Vegetación de Diferencia Normalizada (NDVI) se utiliza para estimar la cantidad y desarrollo de la vegetación de una zona. Se considera la medición de la intensidad de la radiación de algunas bandas del espectro electromagnético que la vegetación emite o refleja1. Se define a partir de la banda roja (\\(Red\\)), que es la banda 4 de Landsat-8 y de Sentinel-2, y la banda correspondiente al infrarrojo cercano (\\(NIR\\)), banda 5 de Landsat-8 y banda 8 de Sentinel-2, mediante la siguiente expresión: \\[\\begin{equation} NDVI = \\frac{NIR - Red}{NIR + Red} \\end{equation}\\] 4.2.1 Obtención en QGIS Para calcular el índice de vegetación, podemos usar los datos de las bandas ráster conjuntamente en la calculadora ráster, accesible desde Ráster &gt; Calculadora ráster… Figura 4.3: Cálculo del índice de vegetación en la calculadora ráster. En la figura 4.3, se muestran las bandas de todos los ráster cargados en el proyecto, seleccionamos las bandas adecuadas según la expresión del índice (pulsando Doble-clic sobre el nombre de la banda en el apartado Bandas ráster, o sobre el operador en el apartado Operadores). La expresión definida se muestra en el apartado Expresión de la calculadora ráster. Podemos indicar el nombre de la capa de salida y el formato, o bien que se genere una capa temporal, en el apartado Capa de resultado. Figura 4.4: Selección de la rampa de color. Para mostrar los resultados de una forma más vistosa, podemos cambiar la rampa de color del ráster obtenido. Esa operación se realiza en el apartado Simbología de las propiedades del ráster (figura 4.4). En este caso, se ha seleccionado la rampa de color RdYlGn, en la que corresponden los colores verdes a los valores más altos del índice. 4.3 Combinar bandas en R A continuación se muestra cómo combinar bandas en R, en particular usando el resultado de satres almacenado en un archivo. Si no se tienen las bandas en el mismo archivo, como es evidente, se han de leer por separado. bboxr10m &lt;- terra::rast(&quot;Pr04/sat_bbox/r10m.tif&quot;) bands &lt;- c(bboxr10m[[&#39;B04&#39;]], bboxr10m[[&#39;B03&#39;]], bboxr10m[[&#39;B02&#39;]]) terra::plotRGB(bands, stretch = &#39;lin&#39;) terra::writeRaster(bands, &quot;Pr04/satfoto_lanjaron_bbox_jsamos.tif&quot;, filetype = &quot;GTiff&quot;, overwrite = TRUE) En este ejemplo, obtenemos el color verdadero a partir de las bandas con resolución de 10m, lo mostramos y lo almacenamos en un archivo. Se pueden encontrar más detalles en https://eos.com/es/make-an-analysis/ndvi/.↩︎ "],["análisis-de-superficies.html", "5 Análisis de superficies 5.1 Mapa de sombras 5.2 Orientación 5.3 Pendiente 5.4 Análisis de superficies en R", " 5 Análisis de superficies En este apartado trabajaremos con el MDT del municipio y realizaremos las operaciones desde QGIS. Las operaciones que vamos a realizar sobre el MDT se pueden llevar a cabo de varias formas. Podemos acceder a la caja de herramientas pulsado sobre Procesos &gt; Caja de herramientas. Figura 5.1: Caja de herramientas de Procesos. Dentro de la caja de herramientas, tenemos dos posibilidades, acceder al apartado Análisis del terreno ráster o bien al apartado GDAL &gt; Análisis ráster (figura 5.1). Adicionalmente, podemos acceder a algunas de las operaciones directamente desde el menú de QGIS, pulsando sobre Ráster &gt; Análisis. 5.1 Mapa de sombras Para calcular el mapa de sombras sobre el MDT desde el menú de QGIS, pulsamos sobre Ráster &gt; Análisis &gt; Mapa de sombras (Hillshade)… Figura 5.2: Definición del mapa de sombras. En la figura 5.2, se muestra la ventana de definición de los parámetros de la operación. Se puede indicar la posición de la luz en cuanto a altitud y azimut, en este caso se han dejado los valores por defecto. Para guardar el resultado, podemos indicar el nombre de un archivo en el campo Mapa de sombras (Hillshade). En el apartado Llamada a la consola de GDAL/OGR se puede ver el comando que se va formando en función de las opciones que seleccionemos. Al ejecutar la operación, obtenemos el mapa de sombras. Este mapa se suele usar para presentar datos (lo usaremos con ese fin). Por ejemplo, últimamente, en el apartado “`El Tiempo”’ de RTVE suelen usar el mapa de sombras de España como fondo para presentar las previsiones meteorológicas. 5.2 Orientación Para obtener la orientación del terreno desde el menú de QGIS, pulsamos sobre Ráster &gt; Análisis &gt; Orientación… En algunas versiones de QGIS, en lugar de Orientación… aparece Aspecto… Es frecuente expresar la orientación mediante el azimut, por lo que podemos dejar los valores por defecto de los parámetros. Por la configuración seleccionada para la operación y los datos del terreno, podemos comprobar que los valores están comprendidos en el intervalo [0, 360] para la nueva capa generada (podemos verlo en el apartado Información de las propiedades de la capa o en la ventana Capas). 5.3 Pendiente Para obtener la pendiente del terreno desde el menú de QGIS, pulsamos sobre Ráster &gt; Análisis &gt; Pendiente… Por defecto expresa la pendiente en grados, aunque también se puede indicar que la exprese mediante un porcentaje. Los parámetros de configuración de esta operación son adecuados. Si hemos indicado que exprese el resultado en grados, los valores deberían estar en el intervalo [0, 90]. 5.4 Análisis de superficies en R A continuación se muestran las operaciones básicas del análisis de superficies en R mediante el paquete terra. mdt_bbox &lt;- terra::rast(&quot;Pr04/mdt_lanjaron_bbox_jsamos.tif&quot;) slope &lt;- terra::terrain(mdt_bbox, v = &#39;slope&#39;, unit = &#39;radians&#39;) terra::plot(slope) aspect &lt;- terra::terrain(mdt_bbox, v = &#39;aspect&#39;, unit = &#39;radians&#39;) terra::plot(aspect) hill &lt;- terra::shade(slope, aspect, 40, 270) terra::plot(hill, col = grey(0:100 / 100)) # presentación de datos terra::plot( hill, col = grey(0:100 / 100), legend = FALSE, mar = c(2, 2, 1, 4) ) terra::plot(mdt_bbox, col = rainbow(50, alpha = 0.35), add = TRUE) Las funciones utilizadas, mediante un parámetro adicional, permiten almacenar el resultado en un archivo. "],["transformación-de-datos-ráster-para-análisis.html", "6 Transformación de datos ráster para análisis 6.1 Curvas de nivel 6.2 Puntos aleatorios", " 6 Transformación de datos ráster para análisis A partir del MDT vamos a generar capas vectoriales de curvas (curvas de nivel) y puntos aleatorios a los que asociaremos su correspondiente altitud. 6.1 Curvas de nivel Para obtener las curvas de nivel, pulsamos sobre Ráster &gt; Extracción &gt; Curvas de nivel… En la ventana de definición de parámetros de la operación, es muy importante el campo Intervalo entre curvas de nivel, que determina la separación y, por tanto, el número de estas. Podemos dejar el valor por defecto o cambiarlo según nuestro propio criterio (según lo accidentado que sea el terreno). Si miramos la tabla de atributos de las curvas generadas, para cada una tenemos un atributo ELEV con la altitud. 6.2 Puntos aleatorios Para obtener un conjunto de puntos aleatorios a partir del MDT, pulsamos sobre Vectorial &gt; Herramientas de investigación &gt; Puntos aleatorios en la extensión… Figura 6.1: Obtención de puntos aleatorios. En la ventana de definición de parámetros de la operación (figura 6.1), en el campo Extensión de entrada seleccionamos la opción Calcular a partir de la capa… y seleccionamos el MDT; podemos indicar el número de puntos (en este caso se ha indicado el valor 1000); también se puede definir una restricción en cuanto a la distancia mínima entre puntos en metros, que en este caso no se ha indicado el valor 50. Como resultado, se han generado los puntos aleatorios en una nueva capa vectorial, dentro de los límites definidos por el MDT, sin embargo, los puntos no tienen asociada la altitud definida en su posición respecto al MDT. Para ello, necesitamos utilizar el complemento Point sampling tool. Figura 6.2: Obtención del valor asociado a los puntos aleatorios. Una vez instalado, accedemos a él mediante su icono en la barra de herramientas. En la ventana de definición de parámetros de la operación (figura 6.2), definimos la capa que contiene los puntos aleatorios y la lista de capas de las que tomar valores. También indicamos el archivo donde almacenar la nueva capa. En la nueva capa generada, los puntos tienen asociado el valor tomado del MDT. "],["presentación-de-datos.html", "7 Presentación de datos", " 7 Presentación de datos En este apartado, vamos a utilizar el MDT y el mapa de sombras para realizar una representación del terreno con una rampa de color adecuada. En el apartado Simbología de las propiedades del MDT, en el campo Tipo de renderizador seleccionamos Pseudocolor monobanda, en el campo Rampa de color seleccionamos la opción Crear nueva rampa de color… Se abre la ventana Tipo de rampa de color y seleccionamos el valor Catálogo: cpt:city. Para esta rampa de color, seleccionamos el nombre Topography y la paleta cd-a. De nuevo en la ventana del apartado Simbología, en el apartado Representación de capas, en el campo Modo de mezcla, elegimos la opción Multiplicar. Figura 7.1: Presentación con el MDT y el mapa de sombras. El resultado obtenido se puede apreciar en la figura 7.1. El orden de las capas en el proyecto es importante. "],["ejercicios.html", "Ejercicios", " Ejercicios Ejercicio 1. Consulta en QGIS Realiza dos consultas sobre una BD con datos de tu municipio desde QGIS o R (solo uno de ellos y las consultas pueden ser equivalentes a las que se han mostrado en este apartado, la BD puede ser cualquiera): utilizando una sola capa, utilizando dos capas. Para documentar la realización del ejercicio en QGIS, para cada consulta, incluye una captura de pantalla de la ventana Administrador de BBDD donde se vea la BD y la consulta, y otra de QGIS donde se presente el resultado de la consulta como una capa del proyecto. Para documentar la realización del ejercicio en R, para cada consulta, incluye una captura de pantalla de RStudio donde se vea el código R y el resultado de la consulta. Ejercicio 2. Analizar bandas de satélite Obtén el color natural y el índice de vegetación para tu municipio (mediante QGIS o R, solo uno de ellos). Almacena los resultados en formato GeoTIFF, en archivos cuyo nombre tenga como prefijo o sufijo el nombre del municipio y tu usuario de correo de la UGR (p.e., en mi caso lanjaron_jsamos_). Para documentar la realización del ejercicio, incluye una captura de pantalla del entorno donde hayas realizado las operaciones donde se muestre cada uno de los resultados obtenidos. Ejercicio 3. Analizar superficies Utilizando el MDT rectangular de tu municipio, (mediante QGIS o R, solo uno de ellos) obtén las capas siguientes: mapa de sombras, orientación, pendiente. Almacena los resultados en formato GeoTIFF, en archivos cuyo nombre tenga como prefijo o sufijo el nombre del municipio y tu usuario de correo de la UGR (p.e., en mi caso lanjaron_jsamos_). Para documentar la realización del ejercicio, incluye una captura de pantalla del entorno donde hayas realizado las operaciones donde se muestre cada uno de los resultados obtenidos. "],["referencias.html", "Referencias", " Referencias Marquez, Angel. 2015. PostGIS Essentials. Packt Publishing. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
